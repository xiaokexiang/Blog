---
title: 类加载顺序及对象初始化
date: 2020-03-13 16:48:17
toc: true
tags: Java
thumbnail: https://image.leejay.top/image/20200511/qBSNbtXB8iRT.jpg?imageslim
---

## 前言

`最近在看Springboot的源码，里面有一个非常重要的组件：BeanPostProcessor(Bean后置处理器)，在对象实例化后初始化前后调用。但是就产生疑惑，因为对此概念有些模糊，所以查阅相关文档并写了代码测试下，作此记录，以备后阅。`

## 概念

### 对象实例化
`简单理解：就是通过关键字: new 创建对象这步骤就称为对象的实例化，也可以理解成开辟内存空间(占坑)。此时对象还没有真正创建(可以理解成还没有初始化)。`
<!--more-->
### 对象初始化
`对象初始化就是在对象实例化后，初始化对象的成员变量并赋予默认值，调用对象的构造函数。`

### 类加载
`无论是对象的实例化或者初始化，他们的行为都必须要在类加载完成之后，其中类加载的顺序是面试中经常遇见的问题`

## 代码解析

``` java
// 模拟类加载、对象实例化和对象初始化流程
public class Objects extends SubObjects {

    // 3. 执行子类静态代码块
    static {
        System.out.println("i'm objects ... ");
    }
    // 6. 先初始化成员变量，并赋予默认值0
    private int i;

    // 7. 再执行构造函数，并进行变量赋值
    public Objects(int i) {
        System.out.println("Objects init ... ");
        this.i = i;
    }

    public static void main(String[] args) {
        // 1.可以理解成对象实例化(类已加载完成)：在内存中开辟空间
        Objects objects = null;
        // 2.对象初始化(成员变量初始化即调用构造函数)， 将引用objects指向创建的对象地址。
        objects = new Objects(1);
        System.out.println(objects.i);
    }
}

class SubObjects {
	// 1.加载父类静态变量或静态代码块(取决于代码顺序)
    static String name = "hello";

    // 4. 加载父类实例成员变量
    int age;

    // 2.加载静态代码块
    static {
        System.out.println(name);
        System.out.println("i'm subObjects ... ");
    }
    // 5.加载父类构造函数
    SubObjects() {
        System.out.println("SubObjects init ...");
    }
}
```
> 1. 无论类是否加载过，静态代码块和静态变量只会被执行一次。如果类已经被加载过，那么只会执行类的实例变量初始化和构造方法。
> 2. 父类静态代码块和静态变量 -> 子类的静态代码块和静态变量 -> 父类实例变量 -> 父类构造函数 -> 子类实例变量 -> 子类构造函数
> 3. 需要注意的是静态代码块和静态变量的顺序取决于代码中的顺序。

## 后记
`其实实例化可以理解成你将一个东西实物化了，和开辟内存空间这个操作对应。初始化理解成在已经有这个东西的基础上定制化它，自定义它。其实怎么说可以，重点在于你怎么理解对象的创建流程。`